<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Futsal League Sydney</title>
  <script src="https://apis.google.com/js/api.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background: #f5f5f5; }
    .container { display: flex; gap: 20px; margin: 20px; }
    .card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
    th { background: #eee; }
    .delete-btn { background: #e74c3c; color: white; border: none; padding: 6px 10px; cursor: pointer; border-radius: 4px; }
    .delete-btn:hover { background: #c0392b; }
  </style>
</head>
<body>
  <h1 style="text-align:center;">Futsal League Sydney</h1>

  <div class="container">
    <!-- FormulÃ¡rio -->
    <div class="card">
      <h2>Match Results</h2>
      <form id="matchForm">
        <label>League</label><br>
        <input type="text" id="league" value="Heffron"><br><br>
        <label>Date</label><br>
        <input type="date" id="date"><br><br>
        <label>Round</label><br>
        <input type="text" id="round"><br><br>
        <label>Home Team</label><br>
        <input type="text" id="homeTeam"><br><br>
        <label>Away Team</label><br>
        <input type="text" id="awayTeam"><br><br>
        <label>Home Goals</label><br>
        <input type="number" id="homeGoals" value="0"><br><br>
        <label>Away Goals</label><br>
        <input type="number" id="awayGoals" value="0"><br><br>
        <button type="submit">Submit Match</button>
      </form>
    </div>

    <!-- Tabela -->
    <div class="card" style="flex:1;">
      <h2>Existing Matches</h2>
      <table id="matchesTable">
        <thead>
          <tr>
            <th>Date</th>
            <th>Round</th>
            <th>Home Team</th>
            <th>Away Team</th>
            <th>Home Goals</th>
            <th>Away Goals</th>
            <th>League</th>
            <th>Registration Date</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <script>
    const SHEET_ID = "COLOQUE_SEU_SHEET_ID_AQUI";
    const API_KEY = "COLOQUE_SEU_API_KEY_AQUI";
    const RANGE = "match-results!A:H"; // inclui atÃ© Registration Date

    // ðŸ”¹ Carregar dados
    function loadMatches() {
      gapi.client.init({
        apiKey: API_KEY,
        discoveryDocs: ["https://sheets.googleapis.com/$discovery/rest?version=v4"],
      }).then(() => {
        return gapi.client.sheets.spreadsheets.values.get({
          spreadsheetId: SHEET_ID,
          range: RANGE,
        });
      }).then(response => {
        const rows = response.result.values;
        const tbody = document.querySelector("#matchesTable tbody");
        tbody.innerHTML = "";

        if (rows.length > 1) {
          rows.slice(1).forEach((row, index) => {
            const tr = document.createElement("tr");

            // Evita datas erradas -> converte para nÃºmero se possÃ­vel
            const safeValue = (val) => {
              if (!val) return "";
              return isNaN(val) ? val : Number(val);
            };

            tr.innerHTML = `
              <td>${row[0] || ""}</td>
              <td>${row[6] || ""}</td>
              <td>${row[1] || ""}</td>
              <td>${row[2] || ""}</td>
              <td>${safeValue(row[3])}</td>
              <td>${safeValue(row[4])}</td>
              <td>${row[5] || ""}</td>
              <td>${row[7] || ""}</td>
              <td><button class="delete-btn" onclick="deleteMatch(${index+2})">Delete</button></td>
            `;
            tbody.appendChild(tr);
          });
        }
      });
    }

    // ðŸ”¹ Deletar linha
    function deleteMatch(rowIndex) {
      if (confirm("Delete this match?")) {
        gapi.client.sheets.spreadsheets.batchUpdate({
          spreadsheetId: SHEET_ID,
          requests: [{
            deleteDimension: {
              range: {
                sheetId: 0, // primeira aba
                dimension: "ROWS",
                startIndex: rowIndex - 1,
                endIndex: rowIndex
              }
            }
          }]
        }).then(() => {
          alert("Match deleted!");
          loadMatches();
        }, err => {
          console.error("Erro ao deletar:", err);
        });
      }
    }

    // ðŸ”¹ Inicializar API
    gapi.load("client", loadMatches);
  </script>
</body>
</html>
